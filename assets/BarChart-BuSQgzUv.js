import{u as _,q as O,m as T,n as W,c as D,e as q,f as A,h as N,i as M,j as H,r as B,b as G,d as X,_ as P}from"./index-DBPWIN5Y.js";import{S as Y,Q as J}from"./query-builder-DjEuht2y.js";import{n as Q,h as $,l as j,a1 as d,$ as b,a2 as u,E as i,H as K,ag as I,_ as w,W as R,a3 as z,G as F,F as Z,a4 as ee,ah as te,N as U,v as ae,a9 as re}from"./vue-vendor-DZH70FcD.js";import{s as k,b as ne,l as le,m as se,a as oe,c as ie,f as ue,e as ce,p as de}from"./d3-vendor-Ss9uNxAN.js";function g(t,e,a={immediate:!0}){const s=_(),r=$(null),n=$(!1),o=$(null),c=()=>a.enabled?.(s.activeConfig.id)??!0;async function y(m=!1){if(!c()){r.value=null,o.value=null,n.value=!1;return}n.value=!0,o.value=null;try{const f=new Y(s.activeConfig),p=new J(s.activeConfig),v=t(p),x=m?await f.queryFresh(v):await f.query(v);r.value=e(x)}catch(f){o.value=f instanceof Error?f.message:"Unknown error occurred",r.value=null}finally{n.value=!1}}return Q(()=>s.activeConfig.id,()=>{a.immediate&&c()?y():(r.value=null,o.value=null,n.value=!1)}),a.immediate&&c()&&y(),{data:r,isLoading:n,error:o,refetch:()=>y(!0)}}function L(t){const e=t.lastIndexOf("#"),a=t.lastIndexOf("/"),s=e>a?e:a;return s>=0?t.substring(s+1):t}function me(t){return t.results.bindings.map(e=>({label:L(e.datatype?.value??"Unknown"),value:parseInt(e.count?.value??"0",10),uri:e.datatype?.value}))}function fe(t){return t.results.bindings.map(e=>({label:e.language?.value??"Unknown",value:parseInt(e.count?.value??"0",10)}))}function pe(t){return t.results.bindings.map(e=>({label:e.propertyLabel?.value??L(e.property?.value??""),value:parseInt(e.statementCount?.value??"0",10),uri:e.property?.value}))}function ve(t){return t.results.bindings.map(e=>({label:e.wikprojectLabel?.value??L(e.wikiproject?.value??""),value:parseInt(e.count?.value??"0",10),uri:e.wikiproject?.value}))}function ye(t){return t.results.bindings.map(e=>({label:e.propertyLabel?.value??L(e.property?.value??""),value:parseInt(e.count?.value??"0",10),uri:e.property?.value}))}function he(t){return t.results.bindings.map(e=>e.val?.value??"").filter(e=>e.length>0)}function Re(){return g(t=>t.buildDatatypeQuery(),me,{immediate:!0,enabled:t=>t!=="commons"})}function De(t=10){return g(e=>e.buildLanguageQuery(t),fe,{immediate:!0,enabled:e=>e!=="commons"})}function ze(t=15){return g(e=>e.buildPropertyStatementQuery(t),pe,{immediate:!0,enabled:e=>e!=="commons"})}function je(t=20){return g(e=>e.buildWikiProjectQuery(t),ve,{immediate:!0,enabled:e=>e==="wikidata"})}function Fe(t=20){return g(e=>e.buildPropertyClassQuery(t),ye,{immediate:!0,enabled:e=>e!=="commons"})}function Pe(t=200){return g(e=>e.buildCommonsDistinctTypesQuery(t),he,{immediate:!0,enabled:e=>e==="commons"})}function be(t,e){const a=`Label,Value,URI
`,s=t.map(n=>{const o=`"${n.label.replace(/"/g,'""')}"`,c=n.uri?`"${n.uri}"`:"";return`${o},${n.value},${c}`}).join(`
`),r=new Blob([a+s],{type:"text/csv;charset=utf-8;"});ge(r,`${e}.csv`)}function ge(t,e){const a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=e,a.click(),URL.revokeObjectURL(a.href)}const xe=j({__name:"ExportMenu",props:{data:{},filename:{}},setup(t){const e=t;function a(){be(e.data,e.filename)}return(s,r)=>(d(),b(O,null,{activator:u(({props:n})=>[i(D,K({icon:"mdi-download",variant:"text",size:"small"},n),null,16)]),default:u(()=>[i(T,{density:"compact"},{default:u(()=>[i(W,{"prepend-icon":"mdi-file-delimited",title:"Export CSV",onClick:a})]),_:1})]),_:1}))}}),Ce={key:0,class:"skeleton-container"},ke={class:"skeleton-bars"},we={class:"d-flex align-end ga-1 skeleton-bar-group"},$e=j({__name:"ChartCard",props:{title:{},subtitle:{},icon:{},loading:{type:Boolean},error:{},exportData:{},exportFilename:{}},emits:["refresh"],setup(t,{emit:e}){const a=e;return(s,r)=>(d(),b(X,{class:"chart-card",height:"100%"},{default:u(()=>[i(q,{class:"d-flex align-center"},{default:u(()=>[t.icon?(d(),b(A,{key:0,icon:t.icon,class:"mr-2",size:"small"},null,8,["icon"])):I("",!0),w(" "+R(t.title)+" ",1),i(N),t.exportData&&t.exportData.length>0&&t.exportFilename?(d(),b(xe,{key:1,data:t.exportData,filename:t.exportFilename},null,8,["data","filename"])):I("",!0),i(D,{icon:"mdi-refresh",variant:"text",size:"small",loading:t.loading,onClick:r[0]||(r[0]=n=>a("refresh"))},null,8,["loading"])]),_:1}),t.subtitle?(d(),b(M,{key:0},{default:u(()=>[w(R(t.subtitle),1)]),_:1})):I("",!0),i(H,{class:"chart-content"},{default:u(()=>[t.loading?(d(),z("div",Ce,[F("div",ke,[i(B,{type:"text",class:"mb-2"}),F("div",we,[(d(),z(Z,null,ee(8,n=>i(B,{key:n,type:"image",class:"skeleton-bar",style:U({height:`${30+Math.random()*70}%`})},null,8,["style"])),64))]),i(B,{type:"text",class:"mt-2"})])])):t.error?(d(),b(G,{key:1,type:"error",variant:"tonal",class:"ma-2"},{append:u(()=>[i(D,{variant:"text",size:"small",onClick:r[1]||(r[1]=n=>a("refresh"))},{default:u(()=>[...r[2]||(r[2]=[w(" Retry ",-1)])]),_:1})]),default:u(()=>[w(R(t.error)+" ",1)]),_:1})):te(s.$slots,"default",{key:2},void 0,!0)]),_:3})]),_:3}))}}),Qe=P($e,[["__scopeId","data-v-3ad47c3e"]]),Le=j({__name:"BarChart",props:{data:{},height:{default:300},barColor:{default:"#3170F3"},hoverColor:{default:"#5090FF"},animated:{type:Boolean,default:!0}},setup(t){const e=t,a=$(null);let s=null;function r(){if(!a.value||!e.data.length)return;k(a.value).selectAll("*").remove();const o=a.value,c=o.clientWidth,y=e.height,m={top:20,right:20,bottom:60,left:50},f=c-m.left-m.right,p=y-m.top-m.bottom,v=k(o).append("svg").attr("width",c).attr("height",y).append("g").attr("transform",`translate(${m.left},${m.top})`),x=ne().range([0,f]).domain(e.data.map(l=>l.label)).padding(.2),C=le().range([p,0]).domain([0,se(e.data,l=>l.value)??0]).nice();v.append("g").attr("transform",`translate(0,${p})`).call(oe(x)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end").style("font-size","11px").style("fill","#9e9e9e"),v.append("g").call(ie(C).ticks(5).tickFormat(ue(".2s"))).selectAll("text").style("fill","#9e9e9e"),v.selectAll(".domain, .tick line").style("stroke","#424242");const S=k(o).append("div").attr("class","chart-tooltip").style("position","absolute").style("visibility","hidden").style("background-color","rgba(45, 46, 69, 0.95)").style("color","#fff").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000").style("box-shadow","0 2px 8px rgba(0,0,0,0.3)"),V=v.selectAll(".bar").data(e.data).enter().append("rect").attr("class","bar").attr("x",l=>x(l.label)??0).attr("width",x.bandwidth()).attr("fill",e.barColor).attr("rx",4).attr("ry",4).style("cursor","pointer");e.animated?V.attr("y",p).attr("height",0).transition().duration(800).delay((l,h)=>h*50).ease(ce.amplitude(1).period(.5)).attr("y",l=>C(l.value)).attr("height",l=>p-C(l.value)):V.attr("y",l=>C(l.value)).attr("height",l=>p-C(l.value)),V.on("mouseover",function(l,h){k(this).transition().duration(200).attr("fill",e.hoverColor),S.style("visibility","visible").html(`<strong>${h.label}</strong><br/>Count: ${h.value.toLocaleString()}`)}).on("mousemove",function(l){const[h,E]=de(l,o);S.style("top",`${E-10}px`).style("left",`${h+15}px`)}).on("mouseout",function(){k(this).transition().duration(200).attr("fill",e.barColor),S.style("visibility","hidden")})}function n(){r()}return ae(()=>{r(),a.value&&(s=new ResizeObserver(n),s.observe(a.value))}),Q(()=>e.data,()=>r(),{deep:!0}),re(()=>{s?.disconnect()}),(o,c)=>(d(),z("div",{ref_key:"chartContainer",ref:a,class:"bar-chart-container",style:U({height:`${t.height}px`})},null,4))}}),Ue=P(Le,[["__scopeId","data-v-d9aade92"]]);export{Ue as B,Qe as C,De as a,ze as b,je as c,Fe as d,Pe as e,Re as u};
//# sourceMappingURL=BarChart-BuSQgzUv.js.map
