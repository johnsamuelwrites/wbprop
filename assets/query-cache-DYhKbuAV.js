const o="wbprop-query-cache";class n{memoryCache=new Map;ttl;maxEntries;storageKey;constructor(t={}){this.ttl=t.ttl??3e5,this.maxEntries=t.maxEntries??100,this.storageKey=t.storageKey??o,this.loadFromStorage()}static makeKey(t,e){const s=e.replace(/\s+/g," ").trim();return`${t}:${s}`}get(t){const e=this.memoryCache.get(t);return e?this.isExpired(e)?(this.memoryCache.delete(t),this.saveToStorage(),null):e.data:null}set(t,e,s){this.memoryCache.size>=this.maxEntries&&this.evictOldest(),this.memoryCache.set(t,{data:e,timestamp:Date.now(),instanceId:s}),this.saveToStorage()}invalidateInstance(t){for(const[e,s]of this.memoryCache)s.instanceId===t&&this.memoryCache.delete(e);this.saveToStorage()}clear(){this.memoryCache.clear();try{localStorage.removeItem(this.storageKey)}catch{}}getStats(){return{entries:this.memoryCache.size,maxEntries:this.maxEntries,ttlMs:this.ttl}}isExpired(t){return Date.now()-t.timestamp>this.ttl}evictOldest(){let t=null,e=1/0;for(const[s,r]of this.memoryCache)r.timestamp<e&&(e=r.timestamp,t=s);t&&this.memoryCache.delete(t)}loadFromStorage(){try{const t=localStorage.getItem(this.storageKey);if(!t)return;const e=JSON.parse(t),s=Date.now();for(const[r,i]of e)s-i.timestamp<=this.ttl&&this.memoryCache.set(r,i)}catch{this.clear()}}saveToStorage(){try{const t=Array.from(this.memoryCache.entries());localStorage.setItem(this.storageKey,JSON.stringify(t))}catch{}}}let a=null;function c(){return a||(a=new n),a}export{n as Q,c as g};
//# sourceMappingURL=query-cache-DYhKbuAV.js.map
