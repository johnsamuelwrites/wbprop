{"version":3,"file":"SearchView-tHmxBvg1.js","sources":["../../src/views/SearchView.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, watch, computed } from 'vue'\nimport { useWikibaseStore } from '@/stores/wikibase'\nimport { SparqlClient, QueryBuilder } from '@/services/sparql'\nimport type { SparqlResults } from '@/types'\n\ninterface SearchResult {\n  id: string\n  label: string\n  description: string\n  uri: string\n}\n\nconst wikibaseStore = useWikibaseStore()\nconst searchQuery = ref('')\nconst loading = ref(false)\nconst results = ref<SearchResult[]>([])\nconst suggestions = ref<SearchResult[]>([])\nconst suggestionsLoading = ref(false)\nconst hasSearched = ref(false)\nconst searchError = ref<string | null>(null)\n\n// Debounced autocomplete\nlet debounceTimer: ReturnType<typeof setTimeout> | null = null\n\nwatch(searchQuery, (newVal) => {\n  if (debounceTimer) clearTimeout(debounceTimer)\n  if (!newVal || newVal.trim().length < 2) {\n    suggestions.value = []\n    return\n  }\n  debounceTimer = setTimeout(() => fetchSuggestions(newVal.trim()), 300)\n})\n\nasync function fetchSuggestions(term: string) {\n  suggestionsLoading.value = true\n  try {\n    const client = new SparqlClient(wikibaseStore.activeConfig)\n    const builder = new QueryBuilder(wikibaseStore.activeConfig)\n    const query = builder.buildPropertySearchQuery(term, 8)\n    const response: SparqlResults = await client.query(query)\n\n    suggestions.value = response.results.bindings.map((binding) => ({\n      id: extractId(binding.property?.value ?? ''),\n      label: binding.propertyLabel?.value ?? '',\n      description: binding.propertyDescription?.value ?? '',\n      uri: binding.property?.value ?? '',\n    }))\n  } catch {\n    suggestions.value = []\n  } finally {\n    suggestionsLoading.value = false\n  }\n}\n\nasync function performSearch() {\n  if (!searchQuery.value.trim()) return\n\n  loading.value = true\n  hasSearched.value = true\n  searchError.value = null\n  suggestions.value = []\n\n  try {\n    const client = new SparqlClient(wikibaseStore.activeConfig)\n    const builder = new QueryBuilder(wikibaseStore.activeConfig)\n    const query = builder.buildPropertySearchQuery(searchQuery.value, 50)\n    const response: SparqlResults = await client.query(query)\n\n    results.value = response.results.bindings.map((binding) => ({\n      id: extractId(binding.property?.value ?? ''),\n      label: binding.propertyLabel?.value ?? '',\n      description: binding.propertyDescription?.value ?? '',\n      uri: binding.property?.value ?? '',\n    }))\n  } catch (error) {\n    searchError.value = error instanceof Error ? error.message : 'Search failed'\n    results.value = []\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction selectSuggestion(suggestion: SearchResult) {\n  searchQuery.value = suggestion.label\n  suggestions.value = []\n  performSearch()\n}\n\nfunction extractId(uri: string): string {\n  const match = uri.match(/[PQ]\\d+$/)\n  return match ? match[0] : uri\n}\n\nfunction openEntityPage(result: SearchResult) {\n  if (result.uri) {\n    window.open(result.uri, '_blank')\n  }\n}\n\nconst resultCount = computed(() => results.value.length)\nconst showSuggestions = computed(() =>\n  suggestions.value.length > 0 && searchQuery.value.trim().length >= 2\n)\n</script>\n\n<template>\n  <div class=\"search-view\">\n    <v-row class=\"mb-4\">\n      <v-col cols=\"12\">\n        <h1 class=\"text-h4 font-weight-bold\">Search Properties</h1>\n        <p class=\"text-subtitle-1 text-medium-emphasis mt-1\">\n          Find properties in {{ wikibaseStore.activeConfig.name }}\n        </p>\n      </v-col>\n    </v-row>\n\n    <v-row>\n      <v-col cols=\"12\" md=\"8\" lg=\"6\">\n        <div class=\"search-container\">\n          <v-text-field\n            v-model=\"searchQuery\"\n            prepend-inner-icon=\"mdi-magnify\"\n            label=\"Search for properties\"\n            placeholder=\"e.g., instance of, date of birth\"\n            variant=\"outlined\"\n            clearable\n            :loading=\"loading || suggestionsLoading\"\n            autocomplete=\"off\"\n            @keyup.enter=\"performSearch\"\n          >\n            <template #append>\n              <v-btn\n                color=\"primary\"\n                :loading=\"loading\"\n                @click=\"performSearch\"\n              >\n                Search\n              </v-btn>\n            </template>\n          </v-text-field>\n\n          <!-- Autocomplete suggestions dropdown -->\n          <v-card\n            v-if=\"showSuggestions\"\n            class=\"suggestions-dropdown\"\n            elevation=\"8\"\n          >\n            <v-list density=\"compact\">\n              <v-list-item\n                v-for=\"suggestion in suggestions\"\n                :key=\"suggestion.id\"\n                @click=\"selectSuggestion(suggestion)\"\n              >\n                <template #prepend>\n                  <v-chip size=\"x-small\" color=\"primary\" variant=\"tonal\" class=\"mr-2\">\n                    {{ suggestion.id }}\n                  </v-chip>\n                </template>\n                <v-list-item-title>{{ suggestion.label }}</v-list-item-title>\n                <v-list-item-subtitle v-if=\"suggestion.description\">\n                  {{ suggestion.description }}\n                </v-list-item-subtitle>\n              </v-list-item>\n            </v-list>\n          </v-card>\n        </div>\n      </v-col>\n    </v-row>\n\n    <!-- Error State -->\n    <v-row v-if=\"searchError\">\n      <v-col cols=\"12\">\n        <v-alert type=\"error\" variant=\"tonal\" closable @click:close=\"searchError = null\">\n          {{ searchError }}\n        </v-alert>\n      </v-col>\n    </v-row>\n\n    <!-- Results -->\n    <v-row v-if=\"hasSearched && !searchError\">\n      <v-col cols=\"12\">\n        <div v-if=\"loading\" class=\"d-flex flex-column ga-3\">\n          <v-skeleton-loader\n            v-for=\"i in 5\"\n            :key=\"i\"\n            type=\"list-item-two-line\"\n          />\n        </div>\n\n        <template v-else>\n          <div v-if=\"resultCount > 0\" class=\"mb-3\">\n            <v-chip size=\"small\" color=\"primary\" variant=\"tonal\">\n              {{ resultCount }} {{ resultCount === 1 ? 'result' : 'results' }}\n            </v-chip>\n          </div>\n\n          <v-card v-if=\"resultCount > 0\">\n            <v-list>\n              <v-list-item\n                v-for=\"result in results\"\n                :key=\"result.id\"\n                :title=\"result.label\"\n                :subtitle=\"result.description\"\n                @click=\"openEntityPage(result)\"\n              >\n                <template #prepend>\n                  <v-chip size=\"small\" color=\"primary\" variant=\"tonal\" class=\"mr-3\">\n                    {{ result.id }}\n                  </v-chip>\n                </template>\n                <template #append>\n                  <v-icon size=\"small\" color=\"medium-emphasis\">mdi-open-in-new</v-icon>\n                </template>\n              </v-list-item>\n            </v-list>\n          </v-card>\n\n          <v-alert v-else type=\"info\" variant=\"tonal\">\n            No properties found matching \"{{ searchQuery }}\".\n          </v-alert>\n        </template>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n\n<style scoped>\n.search-view {\n  padding: 16px;\n}\n\n.search-container {\n  position: relative;\n}\n\n.suggestions-dropdown {\n  position: absolute;\n  top: 56px;\n  left: 0;\n  right: 80px;\n  z-index: 100;\n  max-height: 320px;\n  overflow-y: auto;\n}\n</style>\n"],"names":["wikibaseStore","useWikibaseStore","searchQuery","ref","loading","results","suggestions","suggestionsLoading","hasSearched","searchError","debounceTimer","watch","newVal","fetchSuggestions","term","client","SparqlClient","query","QueryBuilder","response","binding","extractId","performSearch","error","selectSuggestion","suggestion","uri","match","openEntityPage","result","resultCount","computed","showSuggestions","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_v_row","_component_v_col","_cache","_createElementVNode","_hoisted_2","_unref","_hoisted_3","_component_v_text_field","$event","_component_v_btn","_createBlock","_component_v_card","_component_v_list","_Fragment","_renderList","_component_v_list_item","_component_v_chip","_createTextVNode","_toDisplayString","_component_v_list_item_title","_component_v_list_item_subtitle","_component_v_alert","_hoisted_4","i","_component_v_skeleton_loader","_hoisted_5","_component_v_icon"],"mappings":"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"}